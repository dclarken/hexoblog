<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">

<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/hexoblog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/hexoblog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/hexoblog/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/hexoblog/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/hexoblog/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/hexoblog/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/hexoblog/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="陌路 远方 片海">
<meta property="og:type" content="website">
<meta property="og:title" content="Lander Blog">
<meta property="og:url" content="https://github.com/dclarken/hexoblog/page/2/index.html">
<meta property="og:site_name" content="Lander Blog">
<meta property="og:description" content="陌路 远方 片海">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lander Blog">
<meta name="twitter:description" content="陌路 远方 片海">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexoblog/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/dclarken/hexoblog/page/2/"/>





  <title>Lander Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/hexoblog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lander Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/hexoblog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/hexoblog/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/hexoblog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/hexoblog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/hexoblog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/hexoblog/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/16/dp-求两个字符串的最大公共子序列/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/16/dp-求两个字符串的最大公共子序列/" itemprop="url">dp-求两个字符串的最大公共子序列</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-16T00:08:12+08:00">
                2017-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/code/dp/" itemprop="url" rel="index">
                    <span itemprop="name">dp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/hexoblog/2017/09/16/dp-求两个字符串的最大公共子序列/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/16/dp-求两个字符串的最大公共子序列/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function </div><div class="line"><span class="comment">#将python3中的print函数调用，可以实现end=‘’不换行输出的功能</span></div><div class="line"><span class="keyword">import</span> math</div></pre></td></tr></table></figure>
<p>问题描述：<br>求出两个字符串最大公共子序列以及输出他的长度，基础动态规划题目</p>
<p>输入：<br>2017 11 02<br>02 11 2017<br>输出：<br>最大公共子序列</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#_*_coding: utf_8 _*_ </span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcs</span><span class="params">(a,b)</span>:</span></div><div class="line">    lena=len(a)</div><div class="line">    lenb=len(b)</div><div class="line">    c=[[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(lenb+<span class="number">1</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> range(lena+<span class="number">1</span>)]</div><div class="line">    flag=[[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(lenb+<span class="number">1</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> range(lena+<span class="number">1</span>)]</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(lena):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(lenb):</div><div class="line">            <span class="keyword">if</span> a[i]==b[j]:</div><div class="line">                c[i+<span class="number">1</span>][j+<span class="number">1</span>]=c[i][j]+<span class="number">1</span></div><div class="line">                flag[i+<span class="number">1</span>][j+<span class="number">1</span>]=<span class="string">'ok'</span></div><div class="line">            <span class="keyword">elif</span> c[i+<span class="number">1</span>][j]&gt;c[i][j+<span class="number">1</span>]:</div><div class="line">                c[i+<span class="number">1</span>][j+<span class="number">1</span>]=c[i+<span class="number">1</span>][j]</div><div class="line">                flag[i+<span class="number">1</span>][j+<span class="number">1</span>]=<span class="string">'le'</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                c[i+<span class="number">1</span>][j+<span class="number">1</span>]=c[i][j+<span class="number">1</span>]</div><div class="line">                flag[i+<span class="number">1</span>][j+<span class="number">1</span>]=<span class="string">'up'</span></div><div class="line">    maxnum=<span class="number">0</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,lena):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(lenb):</div><div class="line">            <span class="keyword">if</span> flag[-i][-j]==<span class="string">'ok'</span>:</div><div class="line">                count=c[-i][-j]</div><div class="line">                maxnum=max(maxnum,int(count))</div><div class="line">                <span class="keyword">break</span></div><div class="line">    <span class="keyword">return</span> c,flag,maxnum</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">printLcs</span><span class="params">(flag,a,i,j)</span>:</span></div><div class="line">    <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span></div><div class="line">    <span class="keyword">if</span> flag[i][j]==<span class="string">'ok'</span>:</div><div class="line">        printLcs(flag,a,i<span class="number">-1</span>,j<span class="number">-1</span>)</div><div class="line">        </div><div class="line">        print(a[i<span class="number">-1</span>],end=<span class="string">''</span>)</div><div class="line">    <span class="keyword">elif</span> flag[i][j]==<span class="string">'le'</span>:</div><div class="line">        printLcs(flag,a,i,j<span class="number">-1</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        printLcs(flag,a,i<span class="number">-1</span>,j) </div><div class="line">a=<span class="string">'2017 11 02'</span></div><div class="line">b=<span class="string">'02 11 2017'</span></div><div class="line">c,flag,count=lcs(a,b)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</div><div class="line">    print(i)</div><div class="line">print(<span class="string">''</span>)</div><div class="line"><span class="keyword">for</span> j <span class="keyword">in</span> flag:</div><div class="line">    print(j)</div><div class="line">print(<span class="string">''</span>)</div><div class="line">printLcs(flag,a,len(a),len(b))</div><div class="line">print(<span class="string">''</span>)</div><div class="line">print(count)</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/15/Docker内核知识—namespace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/15/Docker内核知识—namespace/" itemprop="url">Docker内核知识——namespace</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-15T00:08:12+08:00">
                2017-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>为了在分布式的环境下进行通信和定位，容器必然需要一个独立的IP、端口、路由等等，自然就想到了网络的隔离。同时，你的容器还需要一个独立的主机名以便在网络中标识自己。想到网络，顺其自然就想到通信，也就想到了进程间通信的隔离。可能你也想到了权限的问题，对用户和用户组的隔离就实现了用户权限的隔离。最后，运行在容器中的应用需要有自己的PID,自然也需要与宿主机中的PID进行隔离。<br>Linux内核中就提供了这六种namespace隔离的系统调用，如下表所示。</p>
<table>
<thead>
<tr>
<th>Namespace</th>
<th>系统调用参数</th>
<th>隔离内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>UTS</td>
<td>CLONE_NEWUTS</td>
<td>主机名与域名</td>
</tr>
<tr>
<td>IPC</td>
<td>CLONE_NEWIPC</td>
<td>信号量、消息队列和共享内存</td>
</tr>
<tr>
<td>PID</td>
<td>CLONE_NEWPID</td>
<td>进程编号</td>
</tr>
<tr>
<td>Network</td>
<td>CLONE_NEWNET</td>
<td>网络设备、网络栈、端口等等</td>
</tr>
<tr>
<td>Mount</td>
<td>CLONE_NEWNS</td>
<td>挂载点（文件系统）</td>
</tr>
<tr>
<td>User</td>
<td>CLONE_NEWUSER</td>
<td>用户和用户组</td>
</tr>
</tbody>
</table>
<p>实现轻量级虚拟化（容器）服务。在同一个namespace下的进程可以感知彼此的变化，而对外界的进程一无所知。这样就可以让容器中的进程产生错觉，仿佛自己置身于一个独立的系统环境中，以此达到独立和隔离的目的。</p>
<hr>
<p><strong><code>六种namespace具体介绍</code></strong></p>
<p><strong>UTS namespace</strong><br>提供了主机名和域名的隔离，这样每个容器就可以拥有了独立的主机名和域名，在网络上可以被视作一个独立的节点而非宿主机上的一个进程。Docker中，每个镜像基本都以自己所提供的服务命名了自己的hostname而没有对宿主机产生任何影响，用的就是这个原理。</p>
<p><strong>IPC</strong><br>容器中进程间通信采用的方法包括常见的信号量、消息队列和共享内存。然而与虚拟机不同的是，容器内部进程间通信对宿主机来说，实际上是具有相同PID namespace中的进程间通信，因此需要一个唯一的标识符来进行区别。申请IPC资源就申请了这样一个全局唯一的32位ID，所以IPC namespace中实际上包含了系统IPC标识符以及实现POSIX消息队列的文件系统。在同一个IPC namespace下的进程彼此可见，而与其他的IPC namespace下的进程则互相不可见。目前使用IPC namespace机制的系统不多，其中比较有名的有PostgreSQL。Docker本身通过socket或tcp进行通信</p>
<p><strong>PID namespace</strong><br>隔离非常实用，它对进程PID重新标号，即两个不同namespace下的进程可以有同一个PID。每个PID namespace都有自己的计数程序。内核为所有的PID namespace维护了一个树状结构，最顶层的是系统初始时创建的，我们称之为root namespace。他创建的新PID namespace就称之为child namespace（树的子节点），而原先的PID namespace就是新创建的PID namespace的parent namespace（树的父节点）。通过这种方式，不同的PID namespaces会形成一个等级体系。所属的父节点可以看到子节点中的进程，并可以通过信号等方式对子节点中的进程产生影响。反过来，子节点不能看到父节点PID namespace中的任何内容。由此产生如下结论<br><a href="http://blog.dotcloud.com/under-the-hood-linux-kernels-on-dotcloud-part" target="_blank" rel="external">部分内容引自</a></p>
<ul>
<li>每个PID namespace中的第一个进程“PID 1“，都会像传统Linux中的init进程一样拥有特权，起特殊作用。</li>
<li>一个namespace中的进程，不可能通过kill或ptrace影响父节点或者兄弟节点中的进程，因为其他节点的PID在这个namespace中没有任何意义。</li>
<li>如果你在新的PID namespace中重新挂载/proc文件系统，会发现其下只显示同属一个PID namespace中的其他进程。</li>
<li>在root namespace中可以看到所有的进程，并且递归包含所有子节点中的进程。</li>
</ul>
<p>在外部监控Docker中运行程序的方法：监控Docker Daemon所在的PID namespace下的所有进程即其子进程，再进行删选即可<br>附：Docker Daemon是Docker架构中运行在后台的守护进程，大致可以分为Docker Server、Engine和Job三部分。Docker Daemon可以认为是通过Docker Server模块接受Docker Client的请求，并在Engine中处理请求，然后根据请求类型，创建出指定的Job并运行，运行过程的作用有以下几种可能：向Docker Registry获取镜像，通过graphdriver执行容器镜像的本地化操作，通过networkdriver执行容器网络环境的配置，通过execdriver执行容器内部运行的执行工作等。<br><a href="http://www.infoq.com/cn/articles/docker-source-code-analysis-part3/" target="_blank" rel="external">docker Daemon</a></p>
<p><strong>Mount namespace</strong><br>通过隔离文件系统挂载点对隔离文件系统提供支持，它是历史上第一个Linux namespace，所以它的标识位比较特殊，就是CLONE_NEWNS。隔离后，不同mount namespace中的文件结构发生变化也互不影响。你可以通过/proc/[pid]/mounts查看到所有挂载在当前namespace中的文件系统，还可以通过/proc/[pid]/mountstats看到mount namespace中文件设备的统计信息，包括挂载文件的名字、文件系统类型、挂载位置等等。<br>进程在创建mount namespace时，会把当前的文件结构复制给新的namespace。新namespace中的所有mount操作都只影响自身的文件系统，而对外界不会产生任何影响。这样做非常严格地实现了隔离，但是某些情况可能并不适用。比如父节点namespace中的进程挂载了一张CD-ROM，这时子节点namespace拷贝的目录结构就无法自动挂载上这张CD-ROM，因为这种操作会影响到父节点的文件系统。<br>挂载状态：共享挂载（shared）、从属挂载（slave）、共享/从属挂载（shared and slave）、私有挂载（private）、不可绑定挂载（unbindable）</p>
<p><strong>Network namespace</strong><br>Network namespace主要提供了关于网络资源的隔离，包括网络设备、IPv4和IPv6协议栈、IP路由表、防火墙、/proc/net目录、/sys/class/net目录、端口（socket）等等。一个物理的网络设备最多存在在一个network namespace中，你可以通过创建veth pair（虚拟网络设备对：有两端，类似管道，如果数据从一端传入另一端也能接收到，反之亦然）在不同的network namespace间创建通道，以此达到通信的目的。</p>
<p><strong>User namespaces</strong><br>User namespace主要隔离了安全相关的标识符（identifiers）和属性（attributes），包括用户ID、用户组ID、root目录、key（指密钥）以及特殊权限。说得通俗一点，一个普通用户的进程通过clone()创建的新进程在新user namespace中可以拥有不同的用户和用户组。这意味着一个进程在容器外属于一个没有特权的普通用户，但是他创建的容器进程却属于拥有所有权限的超级用户，这个技术为容器提供了极大的自由。</p>
<p><a href="http://www.infoq.com/cn/articles/docker-kernel-knowledge-namespace-resource-isolation" target="_blank" rel="external">参考资料来源</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/14/ubuntu下安装dockers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/14/ubuntu下安装dockers/" itemprop="url">ubuntu下安装dockers</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-14T11:31:21+08:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/hexoblog/2017/09/14/ubuntu下安装dockers/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/14/ubuntu下安装dockers/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.linuxidc.com/Linux/2015-04/116051.htm" target="_blank" rel="external">安装文档资料</a><br><a href="http://blog.csdn.net/quuqu/article/details/51488966" target="_blank" rel="external">dockers安装troubleshooting资料</a><br><strong><code>内核变更</code></strong><br>docker再Linux的kernel3.8上运行最佳。<br>利用 uname -r命令查看当前系统版本的内核，内核版本不满足要求，升级内核：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="built_in">get</span> install linux-image-generic-lts-raring linux-headers-generic-lts-raringsudo apt-<span class="built_in">get</span> install --install-recommends linux-generic-lts-raring xserver-xorg-lts-raring libgl1-mesa-glx-lts-raring</div><div class="line">~sudo reboot</div></pre></td></tr></table></figure></p>
<p>重启ubuntu</p>
<p><strong><code>更新apt-get的安装源</code></strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root@linuxidc:~# <span class="keyword">vi</span> /etc/apt/sources.<span class="keyword">list</span></div></pre></td></tr></table></figure></p>
<p>是包管理工具 apt 所用的记录软件包仓库位置的配置文件<br><a href="http://blog.csdn.net/gong_xucheng/article/details/53886271" target="_blank" rel="external">/etc/apt/sources.list 详解</a><br>删除里面的所有内容，把下面的安装源写入</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">deb</span> http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span> http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-security main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span> http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-updates main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span> http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-proposed main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span> http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-backports main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span>-src http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span>-src http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-security main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span>-src http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-updates main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span>-src http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-proposed main restricted universe multiverse</div><div class="line"><span class="keyword">deb</span>-src http://mirrors.aliyun.<span class="keyword">com</span>/ubuntu/ trusty-backports main restricted universe multiverse</div></pre></td></tr></table></figure>
<p><strong><code>然后更新apt-get，利用apt-get安装docker.io</code></strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root@linuxidc:~#apt-<span class="built_in">get</span> <span class="keyword">update</span></div><div class="line">root@linuxidc:~#apt-<span class="built_in">get</span> install docker.io</div><div class="line">root@linuxidc:~# service docker.io restart或者 service docker start</div></pre></td></tr></table></figure></p>
<p>错误信息<br>●报错1：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FATA[<span class="number">0000</span>] Post http:///var/run/docker.sock/v1.<span class="number">18</span>/images/create?fromImage=wpscanteam%<span class="number">2</span>Fvulnerablewordpress%<span class="number">3</span>Alates<span class="variable">t:</span> dial unix /var/run/docker.sock: <span class="keyword">no</span> such <span class="keyword">file</span> <span class="built_in">or</span> directory. Are you trying <span class="keyword">to</span> connect <span class="keyword">to</span> <span class="keyword">a</span> TLS-enabled daemon without TLS?</div></pre></td></tr></table></figure></p>
<p>解决办法：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo touch /var/run/docker.sock</div><div class="line">$ sudo docker -d</div></pre></td></tr></table></figure></p>
<p>touch命令有两个功能：一是用于把已存在文件的时间标签更新为系统当前的时间（默认方式），它们的数据将原封不动地保留下来；二是用来创建新的空文件。<br><a href="http://man.linuxde.net/touch" target="_blank" rel="external">文档资料1</a><br>~docker -d :Run container in background and print container ID 运行容量并且打印容器ID<br><a href="http://www.cnblogs.com/go2bed/p/5703117.html" target="_blank" rel="external">文档资料2</a></p>
<p>●报错2：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">INFO[<span class="number">0000</span>] +job serveapi(unix:///var/run/docker.sock) </div><div class="line">INFO[<span class="number">0000</span>] Listening <span class="keyword">for</span> HTTP <span class="keyword">on</span> unix (/var/run/docker.sock) </div><div class="line">INFO[<span class="number">0000</span>] +job init_networkdriver() </div><div class="line">INFO[<span class="number">0000</span>] -job init_networkdriver() = OK (<span class="number">0</span>) </div><div class="line">WARN[<span class="number">0000</span>] Your kernel does not support cgroup swap limit. </div><div class="line">FATA[<span class="number">0000</span>] Shutting down daemon due <span class="keyword">to</span> error<span class="variable">s:</span> Error loading docker apparmor <span class="keyword">profile</span>: fork/exec /sbin/apparmor_parser: <span class="keyword">no</span> such <span class="keyword">file</span></div></pre></td></tr></table></figure></p>
<p>解决办法：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-<span class="built_in">get</span> install apparmor</div></pre></td></tr></table></figure></p>
<p>Apparmor—Linux内核中的强制访问控制系统，是Linux内核的一个安全模块，AppArmor允许系统管理员将每个程序与一个安全配置文件关联，从而限制程序的功能。简单的说，AppArmor是与SELinux类似的一个访问控制系统，通过它你可以指定程序可以读、写或运行哪些文件，是否可以打开网络端口等。作为对传统Unix的自主访问控制模块的补充，AppArmor提供了强制访问控制机制，它已经被整合到2.6版本的Linux内核中。<br><a href="http://www.cnblogs.com/-Lei/archive/2013/02/24/2923947.html" target="_blank" rel="external">Apparmor</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/14/Docker内核知识—AUFS及安全性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/14/Docker内核知识—AUFS及安全性/" itemprop="url">Docker内核知识——AUFS及安全性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-14T00:08:12+08:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>关于 AUFS（联合文件系统） 的几个特点：</code></p>
<ul>
<li>AUFS 是一种联合文件系统，它把若干目录按照顺序和权限 mount 为一个目录并呈现出来</li>
<li>默认情况下，只有第一层（第一个目录）是可写的，其余层是只读的。</li>
<li>增加文件：默认情况下，新增的文件都会被放在最上面的可写层中。</li>
<li>删除文件：因为底下各层都是只读的，当需要删除这些层中的文件时，AUFS 使用 whiteout 机制，它的实现是通过在上层的可写的目录下建立对应的whiteout隐藏文件来实现的。</li>
<li>修改文件：AUFS 利用其 CoW （copy-on-write）特性来修改只读层中的文件。AUFS 工作在文件层面，因此，只要有对只读层中的文件做修改，不管修改数据的量的多少，在第一次修改时，文件都会被拷贝到可写层然后再被修改。</li>
<li>节省空间：AUFS 的 CoW 特性能够允许在多个容器之间共享分层，从而减少物理空间占用。</li>
<li>查找文件：AUFS 的查找性能在层数非常多时会出现下降，层数越多，查找性能越低，因此，在制作 Docker 镜像时要注意层数不要太多。</li>
<li>性能：AUFS 的 CoW 特性在写入大型文件时第一次会出现延迟。</li>
</ul>
<p><code>一个Linux 系统之中</code></p>
<ul>
<li>所有 Docker 容器都共享主机系统的 bootfs 即 Linux 内核</li>
<li>每个容器有自己的 rootfs，它来自不同的 Linux 发行版的基础镜像，包括 Ubuntu，Debian 和 SUSE 等</li>
<li>在操作系统镜像上面一层层附加应用程序的开源组件的镜像</li>
<li>所有基于一种基础镜像的容器都共享这种 rootfs</li>
</ul>
<p><img src="https://i.loli.net/2017/10/26/59f168e853994.png" alt="tu"></p>
<p><code>安全性:</code></p>
<p>AppArmor, SELinux, GRSEC<br>安全永远是相对的，这里有三个方面可以考虑Docker的安全特性:</p>
<ul>
<li>由kernel namespaces和cgroups实现的Linux系统固有的安全标准;</li>
<li>Docker Deamon的安全接口;</li>
<li>Linux本身的安全加固解决方案,类如AppArmor, SELinux;</li>
</ul>
<p>资料参考：<br><a href="http://www.infoq.com/cn/articles/docker-core-technology-preview/" target="_blank" rel="external">内核知识资料</a><br><a href="http://www.cnblogs.com/sammyliu/p/5931383.html" target="_blank" rel="external">AUFS</a><br><a href="http://www.infoq.com/cn/articles/docker-core-technology-preview/" target="_blank" rel="external">安全性</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/14/Docker内核知识—Cgroup控制组/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/14/Docker内核知识—Cgroup控制组/" itemprop="url">Docker内核知识——Cgroup控制组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-14T00:08:12+08:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>Linux Cgroup</code><br>Docker 容器使用 linux namespace 来隔离其运行环境，使得容器中的进程看起来就像爱一个独立环境中运行一样。但是，光有运行环境隔离还不够，因为这些进程还是可以不受限制地使用系统资源，比如网络、磁盘、CPU以及内存 等。关于其目的，一方面，是为了防止它占用了太多的资源而影响到其它进程；另一方面，在系统资源耗尽的时候，linux 内核会触发 OOM，这会让一些被杀掉的进程成了无辜的替死鬼。因此，为了让容器中的进程更加可控，Docker 使用 Linux cgroups 来限制容器中的进程允许使用的系统资源。<br>Linux Cgroup 可​​​让​​​您​​​为​​​系​​​统​​​中​​​所​​​运​​​行​​​任​​​务​​​（进​​​程​​​）的​​​用​​​户​​​定​​​义​​​组​​​群​​​分​​​配​​​资​​​源​​​ — 比​​​如​​​ CPU 时​​​间​​​、​​​系​​​统​​​内​​​存​​​、​​​网​​​络​​​带​​​宽​​​或​​​者​​​这​​​些​​​资​​​源​​​的​​​组​​​合​​​。​​​您​​​可​​​以​​​监​​​控​​​您​​​配​​​置​​​的​​​ cgroup，拒​​​绝​​​ cgroup 访​​​问​​​某​​​些​​​资​​​源​​​，甚​​​至​​​在​​​运​​​行​​​的​​​系​​​统​​​中​​​动​​​态​​​配​​​置​​​您​​​的​​​ cgroup。所以，可以将 controll groups 理解为 controller （system resource） （for） （process）groups，也就是是说它以一组进程为目标进行系统资源分配和控制。<br>功能：</p>
<ul>
<li>Resource limitation: 限制资源使用，比如内存使用上限以及文件系统的缓存限制。</li>
<li>Prioritization: 优先级控制，比如：CPU利用和磁盘IO吞吐。</li>
<li>Accounting: 一些审计或一些统计，主要目的是为了计费。</li>
<li>Control: 挂起进程，恢复执行进程。</li>
</ul>
<p>使​​​用​​​ cgroup，系​​​统​​​管​​​理​​​员​​​可​​​更​​​具​​​体​​​地​​​控​​​制​​​对​​​系​​​统​​​资​​​源​​​的​​​分​​​配​​​、​​​优​​​先​​​顺​​​序​​​、​​​拒​​​绝​​​、​​​管​​​理​​​和​​​监​​​控​​​。​​​可​​​更​​​好​​​地​​​根​​​据​​​任​​​务​​​和​​​用​​​户​​​分​​​配​​​硬​​​件​​​资​​​源​​​，提​​​高​​​总​​​体​​​效​​​率​​​。</p>
<p><code>在实践中：系统管理员一般会利用CGroup做下面这些事</code><br>（有点像为某个虚拟机分配资源似的）：</p>
<ul>
<li>隔离一个进程集合（比如：nginx的所有进程），并限制他们所消费的资源，比如绑定CPU的核。</li>
<li>为这组进程分配其足够使用的内存</li>
<li>为这组进程分配相应的网络带宽和磁盘存储限制</li>
<li>限制访问某些设备（通过设置设备的白名单）</li>
</ul>
<p><code>子系统说明</code><br>cgroups 实现了对资源的配额和度量。cgroups 的使用非常简单，提供类似文件的接口，在 /cgroup目录下新建一个文件夹即可新建一个group，在此文件夹中新建task文件，并将pid写入该文件，即可实现对该进程的资源控制。groups可以限制blkio、cpu、cpuacct、cpuset、devices、freezer、memory、net_cls、ns九大子系统的资源，以下是每个子系统的详细说明：</p>
<ul>
<li>blkio 这个子系统设置限制每个块设备的输入输出控制。例如:磁盘，光盘以及usb等等。</li>
<li>cpu 这个子系统使用调度程序为cgroup任务提供cpu的访问。</li>
<li>cpuacct 产生cgroup任务的cpu资源报告。</li>
<li>cpuset 如果是多核心的cpu，这个子系统会为cgroup任务分配单独的cpu和内存。</li>
<li>devices 允许或拒绝cgroup任务对设备的访问。</li>
<li>freezer 暂停和恢复cgroup任务。</li>
<li>memory 设置每个cgroup的内存限制以及产生内存资源报告。</li>
<li>net_cls 标记每个网络包以供cgroup方便使用。</li>
<li>ns 名称空间子系统。</li>
</ul>
<p><a href="http://www.cnblogs.com/sammyliu/p/5886833.html" target="_blank" rel="external">参考资料</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/14/贪心算法饭店招待问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/14/贪心算法饭店招待问题/" itemprop="url">贪心算法饭店招待问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-14T00:08:12+08:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/code/贪心/" itemprop="url" rel="index">
                    <span itemprop="name">贪心</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/hexoblog/2017/09/14/贪心算法饭店招待问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/14/贪心算法饭店招待问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>问题描述：<br>某餐馆有n张桌子，每张桌子有一个参数：a 可容纳的最大人数； 有m批客人，每批客人有两个参数:b人数，c预计消费金额。在不允许拼桌的情况下，请实现一个算法选择其中一部分客人，使得总预计消费金额最大</p>
<p>基本思路：<br>桌子序列升序排列，客人按照预定花钱多少降序排序，然后贪心法从钱多的客人开始招呼。在遍历能容得下第i批客人的时候需要二分查找去找否则超时。</p>
<p>输入：<br>3 5<br>2 4 2<br>1 3<br>3 5<br>3 7<br>5 9<br>1 10<br>输出：<br>20</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    n,m=[int(i) <span class="keyword">for</span> i <span class="keyword">in</span> raw_input().split()]</div><div class="line">    a=[int(i) <span class="keyword">for</span> i <span class="keyword">in</span> raw_input().split()]</div><div class="line">    guest=[]</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</div><div class="line">        guest.append([int(i) <span class="keyword">for</span> i <span class="keyword">in</span> raw_input().split()])</div><div class="line">    print(func(n,m,a,guest))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n,m,a,guest)</span>:</span></div><div class="line">    a.sort()</div><div class="line">    value = <span class="number">0</span></div><div class="line">    count = <span class="number">0</span></div><div class="line">    guest.sort(key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>], reverse=<span class="keyword">True</span>)</div><div class="line">    i = <span class="number">0</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> i &lt; m:</div><div class="line">        index=search(a,guest[i][<span class="number">0</span>])</div><div class="line">        <span class="keyword">if</span> index&gt;<span class="number">0</span>:</div><div class="line">            j = j+<span class="number">1</span></div><div class="line">            value +=guest[i][<span class="number">1</span>]</div><div class="line">            <span class="keyword">del</span> a[index]</div><div class="line">            <span class="keyword">if</span> j == n:</div><div class="line">                <span class="keyword">break</span></div><div class="line">        i=i+<span class="number">1</span></div><div class="line">    <span class="keyword">return</span> value</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(nums,target)</span>:</span></div><div class="line">    <span class="keyword">if</span> target&lt;=nums[<span class="number">0</span>]:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">if</span> target&gt;nums[<span class="number">-1</span>]:</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">    l=<span class="number">0</span></div><div class="line">    r=len(nums)<span class="number">-1</span></div><div class="line">    <span class="keyword">while</span> (l+<span class="number">1</span>)!=r:</div><div class="line">        mid=(l+r)/<span class="number">2</span></div><div class="line">        <span class="keyword">if</span> target&lt;=nums[mid]:</div><div class="line">            r=mid</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            l=mid</div><div class="line">    <span class="keyword">return</span> r</div><div class="line">main()</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/12/BGP的工作原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/12/BGP的工作原理/" itemprop="url">BGP的工作原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-12T11:30:21+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/网络协议/" itemprop="url" rel="index">
                    <span itemprop="name">网络协议</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/hexoblog/2017/09/12/BGP的工作原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/12/BGP的工作原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://i.loli.net/2017/10/20/59e999adbe5e3.png" alt="BGP"></p>
<p>在我们使用AWS提供的硬件VPN服务时，可以使用静态和动态的方式构建隧道。<br>静态的是指事先知道对方的公网IP，在两个IP之间写好静态的路由，构建一条加密的隧道<br>动态是指使用BGP协议来自动学习路由。</p>
<p><strong><code>BGP(Border Gateway Protocol)</code></strong><br>边界网关协议，TCP 179<br>BGP是一种在自治系统（AS）之间动态交换路由信息的路由协议。一个自治系统的经典定义是在一个管理机构控制之下的一组路由器，它使用IGP和普通度量值向其他自治系统转发报文。<br>在BGP中使用自治系统这个术语是为了强调这样一个事实：一个自治系统的管理对于其他自治系统而言是提供一个统一的内部选路计划，它为那些通过它可以到达的网络提供了一个一致的描述。BGP,边界网关协议，是自主网络系统中网关之间交换器路由信息的协议。边界网关协议常常应用于互联网的网关之间。路由表包含已知路由器的列表、路由器能够达到的地址以及到达每个路由器的路径的跳数。<br><strong><code>BGP报文的四种类型：</code></strong></p>
<ul>
<li>报文Open：打招呼“你好，跟我交个朋友吧！”</li>
<li>KeepAlive：我还活着呢，别不理我</li>
<li>Update：有新闻……</li>
<li>Notification：我不跟你玩了!</li>
</ul>
<p>BGP协议中消息的应用<br>通过TCP建立BGP连接时，发送open消息<br>连接建立后，如果有路由需要发送或路由变化时，发送UPDATE消息通告对端路由信息<br>稳定后此时要定时发送KEEPALIVE消息（60s）以保持BGP连接的有效性<br>当本地BGP在运行中发现错误时，要发送NOTIFICATION消息通告BGP对端</p>
<p><strong><code>BGP择路的13个规则</code></strong></p>
<ul>
<li>忽略下一跳不可达的路由</li>
<li>忽略不同步的IBGP路由</li>
<li>首选具有最大权重优先，思科私有。(local to router)</li>
<li>首选具有最大本地优先级优先。(global within AS)</li>
<li>首选具有始发本地的路由的路由器优先，(next hop=0.0.0.0)</li>
<li>首选具有最短AS-PATH的路由。</li>
<li>首选具有最小的源码的路由，IGP〈EBP〈incomplete</li>
<li>当所有路由的AS号都相同的时候，首选MED最低的路由，在所有AS号码相同的时候比较MED</li>
<li>首选具有EBGP〉联盟EBGP&gt;IBGP</li>
<li>首选具有最近的IGP邻居路由器优先，metric</li>
<li>首选具有最老的路由优先（注意：现在这条基本不用）</li>
<li>首选具有最低ROUTER-ID的路由。(2个BGP地址不能建邻)</li>
<li>首选具有最低的neighbor的IP地址</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/12/vector用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/12/vector用法/" itemprop="url">vector用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-12T00:08:12+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/c/" itemprop="url" rel="index">
                    <span itemprop="name">c++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://blog.csdn.net/hancunai0017/article/details/7032383" target="_blank" rel="external">文档来自</a><br><strong><code>vector(向量):</code></strong></p>
<p>C++中的一种数据结构,确切的说是一个类.它相当于一个动态的数组,当程序员无法知道自己需要的数组的规模多大时,用其来解决问题可以达到最大节约空间的目的.<br><code>文件包含:</code><br>首先在程序开头处加上#include<vector>以包含所需要的类文件vector还有一定要加上using namespace std;<br><code>变量声明:</code><br>声明一个int向量以替代一维的数组:vector <int> a;用vector代替二维数组.其实只要声明一个一维数组向量即可,而一个数组的名字其实代表的是它的首地址,所以只要声明一个地址的向量即可,即:vector <int *=""> a.同理想用向量代替三维数组也是一样,vector <int**>a;再往上面依此类推.int可以改成其他的如char、string甚至是strcut。<br><code>具体的用法以及函数调用:</code></int**></int></int></vector></p>
<ul>
<li>1.push_back   在数组的最后添加一个数据</li>
<li>2.pop_back    去掉数组的最后一个数据 </li>
<li>3.at                得到编号位置的数据</li>
<li>4.begin           得到数组头的指针</li>
<li>5.end             得到数组的最后一个单元+1的指针</li>
<li>6．front        得到数组头的引用</li>
<li>7.back            得到数组的最后一个单元的引用</li>
<li>8.max_size     得到vector最大可以是多大</li>
<li>9.capacity       当前vector分配的大小</li>
<li>10.size           当前使用数据的大小</li>
<li>11.resize         改变当前使用数据的大小，如果它比当前使用的大者填充默认值</li>
<li>12.reserve      改变当前vecotr所分配空间的大小</li>
<li>13.erase         删除指针指向的数据项</li>
<li>14.clear          清空当前的vector</li>
<li>15.rbegin        将vector反转后的开始指针返回(其实就是原来的end-1)</li>
<li>16.rend          将vector反转构的结束指针返回(其实就是原来的begin-1)</li>
<li>17.empty        判断vector是否为空</li>
<li><p>18.swap         与另一个vector交换数据<br><code>详细的函数实现功能:</code></p>
</li>
<li><p>c.clear()         移除容器中所有数据。</p>
</li>
<li>c.empty()         判断容器是否为空。</li>
<li>c.erase(pos)        删除pos位置的数据</li>
<li>c.erase(beg,end) 删除[beg,end]区间的数据 如： vec.erase(vec.begin()+2);删除第3个元素</li>
<li>c.front()         传回第一个数据。</li>
<li>c.insert(pos,elem)  在pos位置插入一个elem拷贝</li>
<li>c.pop_back()     删除最后一个数据。</li>
<li>c.push_back(elem) 在尾部加入一个数据。</li>
<li>c.resize(num)     重新设置该容器的大小</li>
<li>c.size()         回容器中实际数据的个数。</li>
<li>c.begin()           返回指向容器第一个元素的迭代器</li>
<li>c.end()             返回指向容器最后一个元素的迭代器                                  </li>
<li>c1.swap(c2)==swap(c1,c2)         将c1和c2元素互换。两操作相同。</li>
</ul>
<p><code>#include&lt;algorithm&gt;中的泛函算法</code><br>搜索算法：find() 、search() 、count() 、find_if() 、search_if() 、count_if()<br>分类排序：sort() 、merge()<br>删除算法：unique() 、remove()<br>生成和变异：generate() 、fill() 、transformation() 、copy()<br>关系算法：equal() 、min() 、max()<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sort(v1.begin(),vi.begin()+v1.size/<span class="number">2</span>）;</div></pre></td></tr></table></figure></p>
<p>对v1的前半段元素排序，默认是从小到大排序，即默认为冒泡排序。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sort(v1.begin(),v1.end());</div></pre></td></tr></table></figure></p>
<p>对整个vector做排序<br>定义排序比较函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;a,<span class="keyword">const</span> <span class="keyword">int</span> &amp;b)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">return</span> a&gt;b;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用时:sort(vec.begin(),vec.end(),cmp)，这样就降序排序。<br><code>其他功能:</code></p>
<ul>
<li>c.at(idx)  传回索引idx所指的数据，如果idx越界，抛出out_of_range。 </li>
<li>c.back()  传回最后一个数据，不检查这个数据是否存在。</li>
<li>c.front()  传回地一个数据。 </li>
<li>get_allocator  使用构造函数返回一个拷贝。 </li>
<li>c.rbegin()  传回一个逆向队列的第一个数据。 </li>
<li>c.rend()  传回一个逆向队列的最后一个数据的下一个位置。 </li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/12/linux服务器查看性能的几个命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/12/linux服务器查看性能的几个命令/" itemprop="url">linux服务器查看性能的几个命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-12T00:08:12+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>一、uptime命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ uptime</div><div class="line"><span class="number">23</span>:<span class="number">51</span>:<span class="number">26</span> <span class="keyword">up</span> <span class="number">21</span>:<span class="number">31</span>,  <span class="number">1</span> user,  load average: <span class="number">30.02</span>, <span class="number">26.43</span>, <span class="number">19.02</span></div></pre></td></tr></table></figure>
<p>这个命令可以快速查看机器的负载情况。在Linux系统中，这些数据表示等待CPU资源的进程和阻塞在不可中断IO进程（进程状态为D）的数量。这些数据可以让我们对系统资源使用有一个宏观的了解。<br>命令的输出分别表示<strong>1分钟、5分钟、15分钟的平均负载情况</strong>。通过这三个数据，可以了解服务器负载是在趋于紧张还是趋于缓解。如果1分钟平均负载很高，而15分钟平均负载很低，说明服务器正在命令高负载情况，需要进一步排查CPU资源都消耗在了哪里。反之，如果15分钟平均负载很高，1分钟平均负载较低，则有可能是CPU资源紧张时刻已经过去。<br>上面例子中的输出，可以看见最近1分钟的平均负载非常高，且远高于最近15分钟负载，因此我们需要继续排查当前系统中有什么进程消耗了大量的资源。可以通过下文将会介绍的vmstat、mpstat等命令进一步排查。</p>
<hr>
<p><code>二、dmesg命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ dmesg | tail</div><div class="line">[<span class="number">1880957.563150</span>] <span class="keyword">perl</span> invoked oom-killer: gfp_mask=<span class="number">0</span>x280da, order=<span class="number">0</span>, oom_score_adj=<span class="number">0</span></div><div class="line">[...]</div><div class="line">[<span class="number">1880957.563400</span>] Out of memory: Kill process <span class="number">18694</span> (<span class="keyword">perl</span>) score <span class="number">246</span> <span class="built_in">or</span> sacrifice child</div><div class="line">[<span class="number">1880957.563408</span>] Killed process <span class="number">18694</span> (<span class="keyword">perl</span>) total-<span class="keyword">vm</span>:<span class="number">1972392</span>kB, anon-rs<span class="variable">s:1953348kB</span>, <span class="keyword">file</span>-rs<span class="variable">s:0kB</span></div><div class="line">[<span class="number">2320864.954447</span>] TCP: Possible SYN flooding <span class="keyword">on</span> port <span class="number">7001</span>. Dropping</div><div class="line">request.  Check SNMP counters.</div></pre></td></tr></table></figure>
<p>该命令会输出系统日志的最后10行。示例中的输出，可以看见一次内核的oom kill和一次TCP丢包。这些日志可以帮助排查性能问题。千万不要忘了这一步。</p>
<hr>
<p><code>三、vmstat命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ vmstat <span class="number">1</span></div><div class="line">procs ---------memory---------- ---swap-- -----io---- -<span class="built_in">system</span>-- ------cpu-----</div><div class="line">r  <span class="keyword">b</span> swpd   free   buff  cache   si   <span class="keyword">so</span>    bi    <span class="keyword">bo</span>   in   <span class="keyword">cs</span> us <span class="keyword">sy</span> id <span class="keyword">wa</span> <span class="keyword">st</span></div><div class="line"><span class="number">34</span>  <span class="number">0</span>    <span class="number">0</span> <span class="number">200889792</span>  <span class="number">73708</span> <span class="number">591828</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">5</span>    <span class="number">6</span>   <span class="number">10</span> <span class="number">96</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">0</span>  <span class="number">0</span></div><div class="line"><span class="number">32</span>  <span class="number">0</span>    <span class="number">0</span> <span class="number">200889920</span>  <span class="number">73708</span> <span class="number">591860</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">592</span> <span class="number">13284</span> <span class="number">4282</span> <span class="number">98</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span></div><div class="line"><span class="number">32</span>  <span class="number">0</span>    <span class="number">0</span> <span class="number">200890112</span>  <span class="number">73708</span> <span class="number">591860</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span> <span class="number">9501</span> <span class="number">2154</span> <span class="number">99</span>  <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></div><div class="line"><span class="number">32</span>  <span class="number">0</span>    <span class="number">0</span> <span class="number">200889568</span>  <span class="number">73712</span> <span class="number">591856</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">48</span> <span class="number">11900</span> <span class="number">2459</span> <span class="number">99</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></div><div class="line"><span class="number">32</span>  <span class="number">0</span>    <span class="number">0</span> <span class="number">200890208</span>  <span class="number">73712</span> <span class="number">591860</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span> <span class="number">15898</span> <span class="number">4840</span> <span class="number">98</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span></div></pre></td></tr></table></figure>
<p>vmstat(8) 命令，<strong>每行会输出一些系统核心指标，这些指标可以让我们更详细的了解系统状态</strong>。后面跟的参数1，表示每秒输出一次统计信息，表头提示了每一列的含义，这几介绍一些和性能调优相关的列：</p>
<ul>
<li>r：等待在CPU资源的进程数。这个数据比平均负载更加能够体现CPU负载情况，数据中不包含等待IO的进程。如果这个数值大于机器CPU核数，那么机器的CPU资源已经饱和。</li>
<li>free：系统可用内存数（以千字节为单位），如果剩余内存不足，也会导致系统性能问题。下文介绍到的free命令，可以更详细的了解系统内存的使用情况。</li>
<li>si，so：交换区写入和读取的数量。如果这个数据不为0，说明系统已经在使用交换区（swap），机器物理内存已经不足。</li>
<li>us, sy, id, wa, st：这些都代表了CPU时间的消耗，它们分别表示用户时间（user）、系统（内核）时间（sys）、空闲时间（idle）、IO等待时间（wait）和被偷走的时间（stolen，一般被其他虚拟机消耗）。上述这些CPU时间，可以让我们很快了解CPU是否出于繁忙状态。一般情况下，如果用户时间和系统时间相加非常大，CPU出于忙于执行指令。如果IO等待时间很长，那么系统的瓶颈可能在磁盘IO。</li>
</ul>
<p>示例命令的输出可以看见，大量CPU时间消耗在用户态，也就是用户应用程序消耗了CPU时间。这不一定是性能问题，需要结合r队列，一起分析。</p>
<hr>
<p><code>四、mpstat命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ mpstat -<span class="keyword">P</span> ALL <span class="number">1</span></div><div class="line">Linux <span class="number">3.13</span>.<span class="number">0</span>-<span class="number">49</span>-generic (titanclusters-xxxxx)  <span class="number">07</span>/<span class="number">14</span>/<span class="number">2015</span>  _x86_64_ (<span class="number">32</span> CPU)</div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">49</span> PM  CPU   %usr  %nice   %sys %iowait   %irq  %soft  %steal  %guest  %gnice  %idle</div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">50</span> PM  <span class="keyword">all</span>  <span class="number">98.47</span>   <span class="number">0.00</span>   <span class="number">0.75</span>    <span class="number">0.00</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">0.78</span></div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">50</span> PM    <span class="number">0</span>  <span class="number">96.04</span>   <span class="number">0.00</span>   <span class="number">2.97</span>    <span class="number">0.00</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">0.99</span></div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">50</span> PM    <span class="number">1</span>  <span class="number">97.00</span>   <span class="number">0.00</span>   <span class="number">1.00</span>    <span class="number">0.00</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">2.00</span></div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">50</span> PM    <span class="number">2</span>  <span class="number">98.00</span>   <span class="number">0.00</span>   <span class="number">1.00</span>    <span class="number">0.00</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">1.00</span></div><div class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">50</span> PM    <span class="number">3</span>  <span class="number">96.97</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">0.00</span>   <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">3.03</span></div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>该命令可以显示每个CPU的占用情况，如果有一个CPU占用率特别高，那么有可能是一个单线程应用程序引起的。</p>
<hr>
<p><code>五、pidstat命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ pidstat <span class="number">1</span></div><div class="line">Linux <span class="number">3.13</span>.<span class="number">0</span>-<span class="number">49</span>-generic (titanclusters-xxxxx)  <span class="number">07</span>/<span class="number">14</span>/<span class="number">2015</span>    _x86_64_    (<span class="number">32</span> CPU)</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">02</span> PM   UID       PID    %usr %<span class="built_in">system</span>  %guest    %CPU   CPU  Command</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM     <span class="number">0</span>         <span class="number">9</span>    <span class="number">0.00</span>    <span class="number">0.94</span>    <span class="number">0.00</span>    <span class="number">0.94</span>     <span class="number">1</span>  rcuos/<span class="number">0</span></div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM     <span class="number">0</span>      <span class="number">4214</span>    <span class="number">5.66</span>    <span class="number">5.66</span>    <span class="number">0.00</span>   <span class="number">11.32</span>    <span class="number">15</span>  mesos-slave</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM     <span class="number">0</span>      <span class="number">4354</span>    <span class="number">0.94</span>    <span class="number">0.94</span>    <span class="number">0.00</span>    <span class="number">1.89</span>     <span class="number">8</span>  java</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM     <span class="number">0</span>      <span class="number">6521</span> <span class="number">1596.23</span>    <span class="number">1.89</span>    <span class="number">0.00</span> <span class="number">1598.11</span>    <span class="number">27</span>  java</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM     <span class="number">0</span>      <span class="number">6564</span> <span class="number">1571.70</span>    <span class="number">7.55</span>    <span class="number">0.00</span> <span class="number">1579.25</span>    <span class="number">28</span>  java</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM <span class="number">60004</span>     <span class="number">60154</span>    <span class="number">0.94</span>    <span class="number">4.72</span>    <span class="number">0.00</span>    <span class="number">5.66</span>     <span class="number">9</span>  pidstat</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">03</span> PM   UID       PID    %usr %<span class="built_in">system</span>  %guest    %CPU   CPU  Command</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">04</span> PM     <span class="number">0</span>      <span class="number">4214</span>    <span class="number">6.00</span>    <span class="number">2.00</span>    <span class="number">0.00</span>    <span class="number">8.00</span>    <span class="number">15</span>  mesos-slave</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">04</span> PM     <span class="number">0</span>      <span class="number">6521</span> <span class="number">1590.00</span>    <span class="number">1.00</span>    <span class="number">0.00</span> <span class="number">1591.00</span>    <span class="number">27</span>  java07:<span class="number">41</span>:<span class="number">04</span> PM     <span class="number">0</span>      <span class="number">6564</span> <span class="number">1573.00</span>   <span class="number">10.00</span>    <span class="number">0.00</span> <span class="number">1583.00</span>    <span class="number">28</span>  java</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">04</span> PM   <span class="number">108</span>      <span class="number">6718</span>    <span class="number">1.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">1.00</span>     <span class="number">0</span>  snmp-pass</div><div class="line"><span class="number">07</span>:<span class="number">41</span>:<span class="number">04</span> PM <span class="number">60004</span>     <span class="number">60154</span>    <span class="number">1.00</span>    <span class="number">4.00</span>    <span class="number">0.00</span>    <span class="number">5.00</span>     <span class="number">9</span>  pidstat</div></pre></td></tr></table></figure>
<p>pidstat命令输出<strong>进程的CPU占用率</strong>，该命令会持续输出，并且不会覆盖之前的数据，可以方便观察系统动态。如上的输出，可以看见两个JAVA进程占用了将近1600%的CPU时间，既消耗了大约16个CPU核心的运算资源。</p>
<hr>
<p><code>六、iostat命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ iostat -xz <span class="number">1</span></div><div class="line">Linux <span class="number">3.13</span>.<span class="number">0</span>-<span class="number">49</span>-generic (titanclusters-xxxxx)  <span class="number">07</span>/<span class="number">14</span>/<span class="number">2015</span>  _x86_64_ (<span class="number">32</span> CPU)</div><div class="line">avg-cpu:  %user   %nice %<span class="built_in">system</span> %iowait  %steal   %idle</div><div class="line"><span class="number">73.96</span>    <span class="number">0.00</span>    <span class="number">3.73</span>    <span class="number">0.03</span>    <span class="number">0.06</span>   <span class="number">22.21</span></div><div class="line">Device:   rrqm/s   wrqm/s     r/s     <span class="keyword">w</span>/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</div><div class="line">xvda        <span class="number">0.00</span>     <span class="number">0.23</span>    <span class="number">0.21</span>    <span class="number">0.18</span>     <span class="number">4.52</span>     <span class="number">2.08</span>    <span class="number">34.37</span>     <span class="number">0.00</span>    <span class="number">9.98</span>   <span class="number">13.80</span>    <span class="number">5.42</span>   <span class="number">2.44</span>   <span class="number">0.09</span></div><div class="line">xvdb        <span class="number">0.01</span>     <span class="number">0.00</span>    <span class="number">1.02</span>    <span class="number">8.94</span>   <span class="number">127.97</span>   <span class="number">598.53</span>   <span class="number">145.79</span>     <span class="number">0.00</span>    <span class="number">0.43</span>    <span class="number">1.78</span>    <span class="number">0.28</span>   <span class="number">0.25</span>   <span class="number">0.25</span></div><div class="line">xvdc        <span class="number">0.01</span>     <span class="number">0.00</span>    <span class="number">1.02</span>    <span class="number">8.86</span>   <span class="number">127.79</span>   <span class="number">595.94</span>   <span class="number">146.50</span>     <span class="number">0.00</span>    <span class="number">0.45</span>    <span class="number">1.82</span>    <span class="number">0.30</span>   <span class="number">0.27</span>   <span class="number">0.26</span></div><div class="line">dm-<span class="number">0</span>        <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.69</span>    <span class="number">2.32</span>    <span class="number">10.47</span>    <span class="number">31.69</span>    <span class="number">28.01</span>     <span class="number">0.01</span>    <span class="number">3.23</span>    <span class="number">0.71</span>    <span class="number">3.98</span>   <span class="number">0.13</span>   <span class="number">0.04</span></div><div class="line">dm-<span class="number">1</span>        <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.94</span>     <span class="number">0.01</span>     <span class="number">3.78</span>     <span class="number">8.00</span>     <span class="number">0.33</span>  <span class="number">345.84</span>    <span class="number">0.04</span>  <span class="number">346.81</span>   <span class="number">0.01</span>   <span class="number">0.00</span></div><div class="line">dm-<span class="number">2</span>        <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.09</span>    <span class="number">0.07</span>     <span class="number">1.35</span>     <span class="number">0.36</span>    <span class="number">22.50</span>     <span class="number">0.00</span>    <span class="number">2.55</span>    <span class="number">0.23</span>    <span class="number">5.62</span>   <span class="number">1.78</span>   <span class="number">0.03</span></div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>iostat命令主要用于查看<strong>机器磁盘IO</strong>情况。该命令输出的列，主要含义是：</p>
<ul>
<li>r/s, w/s, rkB/s, wkB/s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。</li>
<li>await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。</li>
<li>avgqu-sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。</li>
<li>%util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。</li>
</ul>
<p>如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。</p>
<hr>
<p><code>七、free命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ free -<span class="keyword">m</span></div><div class="line">total       used       free     shared    <span class="keyword">buffers</span>     cached</div><div class="line">Mem:        <span class="number">245998</span>      <span class="number">24545</span>     <span class="number">221453</span>         <span class="number">83</span>         <span class="number">59</span>        <span class="number">541</span></div><div class="line">-/+ <span class="keyword">buffers</span>/cache:      <span class="number">23944</span>     <span class="number">222053</span></div><div class="line">Swap:            <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span></div></pre></td></tr></table></figure>
<p>free命令可以查看<strong>系统内存的使用情况</strong>，-m参数表示按照兆字节展示。最后两列分别表示用于IO缓存的内存数，和用于文件系统页缓存的内存数。需要注意的是，第二行-/+ buffers/cache，看上去缓存占用了大量内存空间。<br>这是Linux系统的内存使用策略，尽可能的利用内存，如果应用程序需要内存，这部分内存会立即被回收并分配给应用程序。因此，这部分内存一般也被当成是可用内存。<br>如果可用内存非常少，系统可能会动用交换区（如果配置了的话），这样会增加IO开销（可以在iostat命令中提现），降低系统性能。</p>
<hr>
<p><code>八、sar命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sar -n DEV <span class="number">1</span></div><div class="line">Linux <span class="number">3.13</span>.<span class="number">0</span>-<span class="number">49</span>-generic (titanclusters-xxxxx)  <span class="number">07</span>/<span class="number">14</span>/<span class="number">2015</span>     _x86_64_    (<span class="number">32</span> CPU)</div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">48</span> AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">49</span> AM      eth0  <span class="number">18763.00</span>   <span class="number">5032.00</span>  <span class="number">20686.42</span>    <span class="number">478.30</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">49</span> AM        <span class="keyword">lo</span>     <span class="number">14.00</span>     <span class="number">14.00</span>      <span class="number">1.36</span>      <span class="number">1.36</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">49</span> AM   docker0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">49</span> AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">50</span> AM      eth0  <span class="number">19763.00</span>   <span class="number">5101.00</span>  <span class="number">21999.10</span>    <span class="number">482.56</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">50</span> AM        <span class="keyword">lo</span>     <span class="number">20.00</span>     <span class="number">20.00</span>      <span class="number">3.25</span>      <span class="number">3.25</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">16</span>:<span class="number">50</span> AM   docker0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div></pre></td></tr></table></figure>
<p>sar命令在这里可以查看<strong>网络设备的吞吐率</strong>。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和。如示例输出中，eth0网卡设备，吞吐率大概在22 Mbytes/s，既176 Mbits/sec，没有达到1Gbit/sec的硬件上限。<br>sar -n TCP,ETCP 1<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sar -n TCP,ETCP <span class="number">1</span></div><div class="line">Linux <span class="number">3.13</span>.<span class="number">0</span>-<span class="number">49</span>-generic (titanclusters-xxxxx)  <span class="number">07</span>/<span class="number">14</span>/<span class="number">2015</span>    _x86_64_    (<span class="number">32</span> CPU)</div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">19</span> AM  active/s passive/s    iseg/s    oseg/s</div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">20</span> AM      <span class="number">1.00</span>      <span class="number">0.00</span>  <span class="number">10233.00</span>  <span class="number">18846.00</span></div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">19</span> AM  atmptf/s  estres/s retrans/s isegerr/s   orsts/s</div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">20</span> AM      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">20</span> AM  active/s passive/s    iseg/s    oseg/s</div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">21</span> AM      <span class="number">1.00</span>      <span class="number">0.00</span>   <span class="number">8359.00</span>   <span class="number">6039.00</span></div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">20</span> AM  atmptf/s  estres/s retrans/s isegerr/s   orsts/s</div><div class="line"><span class="number">12</span>:<span class="number">17</span>:<span class="number">21</span> AM      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div></pre></td></tr></table></figure></p>
<p>sar命令在这里用于<strong>查看TCP连接状态</strong>，其中包括：</p>
<ul>
<li>active/s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；</li>
<li>passive/s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；</li>
<li>retrans/s：每秒TCP重传数量；</li>
</ul>
<p>TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压</p>
<p>sar命令也可以查看指定pid的信息</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sar -<span class="keyword">x</span> pid <span class="number">1</span> <span class="number">1000</span></div></pre></td></tr></table></figure>
<hr>
<p><code>九、top命令</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ top</div><div class="line">top - <span class="number">00</span>:<span class="number">15</span>:<span class="number">40</span> <span class="keyword">up</span> <span class="number">21</span>:<span class="number">56</span>,  <span class="number">1</span> user,  load average: <span class="number">31.09</span>, <span class="number">29.87</span>, <span class="number">29.92</span></div><div class="line">Task<span class="variable">s:</span> <span class="number">871</span> total,   <span class="number">1</span> running, <span class="number">868</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">2</span> zombie</div><div class="line">%Cpu(s): <span class="number">96.8</span> us,  <span class="number">0.4</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">2.7</span> id,  <span class="number">0.1</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></div><div class="line">KiB Mem:  <span class="number">25190241</span>+total, <span class="number">24921688</span> used, <span class="number">22698073</span>+free,    <span class="number">60448</span> <span class="keyword">buffers</span></div><div class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> used,        <span class="number">0</span> free.   <span class="number">554208</span> cached Mem</div><div class="line">PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</div><div class="line"><span class="number">20248</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">0.227</span>t <span class="number">0.012</span>t  <span class="number">18748</span> S  <span class="number">3090</span>  <span class="number">5.2</span>  <span class="number">29812</span>:<span class="number">58</span> java</div><div class="line"><span class="number">4213</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">2722544</span>  <span class="number">64640</span>  <span class="number">44232</span> S  <span class="number">23.5</span>  <span class="number">0.0</span> <span class="number">233</span>:<span class="number">35.37</span> mesos-slave</div><div class="line"><span class="number">66128</span> titancl+  <span class="number">20</span>   <span class="number">0</span>   <span class="number">24344</span>   <span class="number">2332</span>   <span class="number">1172</span> R   <span class="number">1.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.07</span> top</div><div class="line"><span class="number">5235</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">38.227</span>g <span class="number">547004</span>  <span class="number">49996</span> S   <span class="number">0.7</span>  <span class="number">0.2</span>   <span class="number">2</span>:<span class="number">02.74</span> java</div><div class="line"><span class="number">4299</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">20.015</span>g <span class="number">2.682</span>g  <span class="number">16836</span> S   <span class="number">0.3</span>  <span class="number">1.1</span>  <span class="number">33</span>:<span class="number">14.42</span> java     </div><div class="line"><span class="number">1</span> root      <span class="number">20</span>   <span class="number">0</span>   <span class="number">33620</span>   <span class="number">2920</span>   <span class="number">1496</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">03.82</span> init</div><div class="line"><span class="number">2</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.02</span> kthreadd</div><div class="line"><span class="number">3</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">05.35</span> ksoftirqd/<span class="number">0</span></div><div class="line"><span class="number">5</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kworker/<span class="number">0</span>:<span class="number">0</span>H</div><div class="line"><span class="number">6</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">06.94</span> kworker/u256:<span class="number">0</span></div><div class="line"><span class="number">8</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">2</span>:<span class="number">38.05</span> rcu_sched</div></pre></td></tr></table></figure>
<p>top命令<strong>包含了前面好几个命令的检查的内容。比如系统负载情况（uptime）、系统内存使用情况（free）、系统CPU使用情况（vmstat）等。因此通过这个命令，可以相对全面的查看系统负载的来源</strong>。同时，top命令支持排序，可以按照不同的列排序，方便查找出诸如内存占用最多的进程、CPU占用率最高的进程等。<br>但是，top命令相对于前面一些命令，输出是一个瞬间值，如果不持续盯着，可能会错过一些线索。这时可能需要暂停top命令刷新，来记录和比对数据。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/dclarken/hexoblog/hexoblog/2017/09/11/top命令详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daichao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/10/21/59eb564170624.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lander Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexoblog/2017/09/11/top命令详解/" itemprop="url">top命令详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-11T00:08:12+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexoblog/categories/笔记/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ top</div><div class="line">top - <span class="number">00</span>:<span class="number">15</span>:<span class="number">40</span> <span class="keyword">up</span> <span class="number">21</span>:<span class="number">56</span>,  <span class="number">1</span> user,  load average: <span class="number">31.09</span>, <span class="number">29.87</span>, <span class="number">29.92</span></div><div class="line">Task<span class="variable">s:</span> <span class="number">871</span> total,   <span class="number">1</span> running, <span class="number">868</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">2</span> zombie</div><div class="line">%Cpu(s): <span class="number">96.8</span> us,  <span class="number">0.4</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">2.7</span> id,  <span class="number">0.1</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></div><div class="line">KiB Mem:  <span class="number">25190241</span>+total, <span class="number">24921688</span> used, <span class="number">22698073</span>+free,    <span class="number">60448</span> <span class="keyword">buffers</span></div><div class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> used,        <span class="number">0</span> free.   <span class="number">554208</span> cached Mem</div><div class="line">PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</div><div class="line"><span class="number">20248</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">0.227</span>t <span class="number">0.012</span>t  <span class="number">18748</span> S  <span class="number">3090</span>  <span class="number">5.2</span>  <span class="number">29812</span>:<span class="number">58</span> java</div><div class="line"><span class="number">4213</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">2722544</span>  <span class="number">64640</span>  <span class="number">44232</span> S  <span class="number">23.5</span>  <span class="number">0.0</span> <span class="number">233</span>:<span class="number">35.37</span> mesos-slave</div><div class="line"><span class="number">66128</span> titancl+  <span class="number">20</span>   <span class="number">0</span>   <span class="number">24344</span>   <span class="number">2332</span>   <span class="number">1172</span> R   <span class="number">1.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.07</span> top</div><div class="line"><span class="number">5235</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">38.227</span>g <span class="number">547004</span>  <span class="number">49996</span> S   <span class="number">0.7</span>  <span class="number">0.2</span>   <span class="number">2</span>:<span class="number">02.74</span> java</div><div class="line"><span class="number">4299</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">20.015</span>g <span class="number">2.682</span>g  <span class="number">16836</span> S   <span class="number">0.3</span>  <span class="number">1.1</span>  <span class="number">33</span>:<span class="number">14.42</span> java     </div><div class="line"><span class="number">1</span> root      <span class="number">20</span>   <span class="number">0</span>   <span class="number">33620</span>   <span class="number">2920</span>   <span class="number">1496</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">03.82</span> init</div><div class="line"><span class="number">2</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.02</span> kthreadd</div><div class="line"><span class="number">3</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">05.35</span> ksoftirqd/<span class="number">0</span></div><div class="line"><span class="number">5</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kworker/<span class="number">0</span>:<span class="number">0</span>H</div><div class="line"><span class="number">6</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">06.94</span> kworker/u256:<span class="number">0</span></div><div class="line"><span class="number">8</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">2</span>:<span class="number">38.05</span> rcu_sched</div></pre></td></tr></table></figure>
<p><code>第一行：</code>uptime命令一样</p>
<p>top：   这个没有什么意思，只是个名称而以<br>01：47：56 ：     系统当前时间<br>up 1:26   ：   系统开机到现在经过了多少时间<br>2 users  ：            当前2用户在线<br>load average:0.00,0.00,0.00：        系统1分钟、5分钟、15分钟的CPU负载信息</p>
<p><code>第二行：</code>vmstat</p>
<p>Tasks：英文意思是工作;任务;差事。<br>38 total：很好理解，就是当前有38个任务，也就是38个进程。<br>1 running：1个进程正在运行<br>37 sleeping：37个进程睡眠<br>0 stopped：停止的进程数<br>0 zombie：僵死的进程数<br>Cpu(s)：表示这一行显示CPU总体信息<br>0.0%us：用户态进程占用CPU时间百分比，不包含renice值为负的任务占用的CPU的时间。<br>0.7%sy：内核占用CPU时间百分比<br>0.0%ni：renice值为负的任务的用户态进程的CPU时间百分比。nice是优先级的意思<br>99.3%id：空闲CPU时间百分比<br>0.0%wa：等待I/O的CPU时间百分比<br>0.0%hi：CPU硬中断时间百分比<br>0.0%si：CPU软中断时间百分比<br>0.0%st：被偷走的时间</p>
<p><code>第三行：</code>free</p>
<p>Men：内存的意思<br>256412k total：物理内存总量<br>30156k used：使用的物理内存量<br>226256 free：空闲的物理内存量<br>8176k buffers：用作内核缓存的物理内存量<br>Swap：交换空间<br>337356k total：交换区总量<br>0k used：使用的交换区量<br>337356k free：空闲的交换区量<br>12160k cached：缓冲交换区总量</p>
<p><code>第四行：</code>pidstat</p>
<p>PID：进程的ID<br>USER：进程所有者<br>PR：进程的优先级别，越小越优先被执行<br>NInice：值<br>VIRT：进程占用的虚拟内存<br>RES：进程占用的物理内存<br>SHR：进程使用的共享内存<br>S：进程的状态。S表示休眠，R表示正在运行，Z表示僵死状态，N表示该进程优先值为负数<br>%CPU：进程占用CPU的使用率<br>%MEM：进程使用的物理内存和总内存的百分比<br>TIME+：该进程启动后占用的总的CPU时间，即占用CPU使用时间的累加值。<br>COMMAND：进程启动命令名称</p>
<p><code>一些常用的linux top命令操作指令：</code></p>
<p>q：退出top命令<br>空格：立即刷新<br>s：设置刷新时间间隔<br>c：显示命令完全模式<br>t:：显示或隐藏进程和CPU状态信息<br>m：显示或隐藏内存状态信息<br>l：显示或隐藏uptime信息<br>f：增加或减少进程显示标志<br>S：累计模式，会把已完成或退出的子进程占用的CPU时间累计到父进程的MITE+<br>P：按%CPU使用率排行<br>T：按MITE+排行<br>M：按%MEM排行<br>u：指定显示用户进程<br>r：修改进程renice值<br>kkill：进程<br>i：只显示正在运行的进程<br>W：保存对top的设置到文件~/.toprc，下次启动将自动调用toprc文件的设置。<br>h：帮助命令。<br><a href="http://www.itwhy.org/2011/07-05/437.html" target="_blank" rel="external">原文</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexoblog/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/hexoblog/">1</a><span class="page-number current">2</span><a class="page-number" href="/hexoblog/page/3/">3</a><a class="page-number" href="/hexoblog/page/4/">4</a><a class="extend next" rel="next" href="/hexoblog/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://i.loli.net/2017/10/21/59eb564170624.png"
                alt="Daichao" />
            
              <p class="site-author-name" itemprop="name">Daichao</p>
              <p class="site-description motion-element" itemprop="description">陌路 远方 片海</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/hexoblog/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/hexoblog/categories/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/hexoblog/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/dclarken" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:dclarken@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/LanderDai" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-globe"></i>Twitter</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daichao</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/hexoblog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/hexoblog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/hexoblog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/hexoblog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hexoblog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hexoblog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/hexoblog/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/hexoblog/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/hexoblog/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/hexoblog/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/hexoblog/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Dc.disqus.com/count.js" async></script>
    

    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/hexoblog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  

  

  

</body>



</html>
